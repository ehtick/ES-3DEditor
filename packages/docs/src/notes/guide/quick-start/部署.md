---
title: 部署
createTime: 2025/03/29 23:50:17
permalink: /guide/n6o11owv/
---

> 本文档适用于部署 Astral3D 编辑器到服务器上。 <br />
> 以[Java版本](https://github.com/yx8663/astral-service)后端为例，其他语言版本后端部署方式请参考官方文档。

## 本地打包

### 前端打包
```bash
# 确认 Node.js 版本（≥ 23.11.x）
node -v

# 拉取代码
git clone https://github.com/mlt131220/Astral3D.git

# 进入项目
cd Astral3D

# 安装依赖
pnpm install

# 打包 Astral 3D Engine SDK
pnpm run sdk:build

# 打包Astral 3D Editor
pnpm run editor:build
```

### 后端打包
```bash
# 确认java环境
java -version

# 确认maven环境
mvn -v

# 拉取代码
git clone https://github.com/yx8663/astral-service

# 安装依赖
mvn clean install

# 修改数据库等配置（修改 astral-web/src/main/resources/application-dev.yml，详见 https://github.com/yx8663/astral-service/blob/develop/README.md#%E9%85%8D%E7%BD%AE）
vim astral-web/src/main/resources/application-dev.yml

# 编译打包（通过maven打包即可跨平台）
# 生产环境推荐用clean package跳过测试
mvn clean package -DskipTests

# jar包： astral-web/target/astral-web.jar
ls -l astral-web/target/*.jar
```

## 服务器部署(Windows)

### 基础环境
- [Nginx](https://nginx.org/en/download.html)/[caddy](https://caddyserver.com/)
- [MySQL](https://www.mysql.com/cn/downloads/)

或者直接使用集成环境，如[PHPStudy](https://old.xp.cn/download.html)。

### 前端部署
将Astral 3D Editor打包后的文件放到方便读取的目录下，如 `C:\www\Astral3dEditor`;

### 后端部署
1. 将后端部署所需文件/文件夹放到方便读取的目录下，如 `C:\www\Astral3DEditorBack`,所需文件/文件夹如下：
   * `static` 文件夹；
   * `astral-web/target/astral-web.jar`；
   * `astral-web/src/main/resources/application.yml`
   * `astral-web/src/main/resources/application-dev.yml`
2. 此时`C:\www\Astral3DEditorBack`内容如下：  

   ``` shell
    - static/
    - application.yml
    - application-dev.yml
    - astral-web.jar
   ```

3. 打开 MySQL 数据库，创建配置在 `application-dev.yml` 的数据库，并导入 `static/sql/astral_3d.sql` 文件；
4. 启动 MySQL 服务，并确保 MySQL 服务正常运行；
5. 在 `C:\www\Astral3DEditorBack` 下运行命令 `java -jar astral-web.jar` 启动后端服务，默认监听 `8080` 端口；

### Nginx 配置
1. 打开 Nginx 配置文件，假设nginx安装目录为`C:\nginx`,则配置文件路径为`C:\nginx\conf\nginx.conf`;
2. 在 `http` 块中添加以下配置：
    ```
    http {
        # ... 忽略原有其他配置不变更
        
        # 开启gzip
        gzip on;
        
        # 导入所有的server配置
        include vhosts/*.conf;
    }
    ```
3. 在 `C:\nginx\conf` 目录下创建 `vhosts` 目录(与上方http中增加的配置路径同名，并非一定要为`vhost`,可以自定义);
4. 在 `C:\nginx\conf\vhosts` 目录下创建 `astral3d.conf` 文件，内容如下：
    ```
   server {
        # 监听端口,即前端部署的端口，一般设置为80
        listen        80;
        # 域名/ip/localhost
        server_name  127.0.0.1;

        # 访问 server_name:listen 后，请求就会被转发到这个location块中
        location / {
            # 前端部署的目录，即前端打包后的文件所在目录
            root   "C:\www\Astral3dEditor";
            # 文件url重写规则，将请求转发到index.html（单页面应用）
            try_files $uri $uri/ index.html;
            # 项目入口文件
            index  index.html;
   
            # 协商缓存配置，30天
            add_header Cache-Control "public, max-age=2592000";
            expires 30d;
            etag on;
        }

        # 后端api接口代理，接口请求匹配 /api 的会走此处转发，下面都同理
        location /api {
            # 后端接口访问地址，上面部署在了本机的8080端口
            proxy_pass http://127.0.0.1:8080/api;
        }

        # 前端websocket代理
        location /socket {
            proxy_pass http://127.0.0.1:8080/api/sys/ws; 

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "Upgrade";
            proxy_connect_timeout  10s;
            proxy_read_timeout  300s;
            proxy_send_timeout  300s;
        }

        location /file/static {
            log_not_found off;
            # 关闭日志
            access_log off;
            # 强缓存设置，缓存时间设置为0.5年
            add_header Cache-Control "public, max-age=15768000";
            
            proxy_pass http://localhost:8080/api/common/static;
        }
    }
   ```

### 启动服务
```bash
nginx -s start

# 重启 nginx（如果修改了配置文件）
nginx -s reload
```
此时访问 `http://127.0.0.1` 即可访问到 Astral 3D Editor。


## 服务器部署(Linux)


## Docker 部署

